# VigilOps 客户使用指南

> 欢迎使用 VigilOps 运维监控平台！本指南帮助您快速上手。

---

## 目录

1. [登录和初始设置](#1-登录和初始设置)
2. [Dashboard 概览](#2-dashboard-概览)
3. [主机和服务监控](#3-主机和服务监控)
4. [告警规则配置](#4-告警规则配置)
5. [通知渠道配置](#5-通知渠道配置)
6. [AI 分析功能](#6-ai-分析功能)
7. [数据库监控](#7-数据库监控)（专业版）
8. [自动修复](#8-自动修复)（专业版）
9. [运维报告](#9-运维报告)
10. [常见问题](#10-常见问题)

---

## 1. 登录和初始设置

### 1.1 首次登录

1. 在浏览器中访问我们为您部署的平台地址（如 `http://your-server:3001`）
2. 使用我们提供的管理员账号和密码登录
3. **强烈建议**：登录后立即修改默认密码

### 1.2 初始配置

部署完成后，我们已为您完成以下初始配置：

- ✅ 默认告警规则（CPU > 90%、内存 > 85%、磁盘 > 90%、主机离线）
- ✅ 默认通知模板（中文）
- ✅ Agent 已安装到您的主机

您需要自行完成：

- 📌 配置通知渠道（钉钉/飞书/企微/邮件，至少 1 个）
- 📌 根据业务需要调整告警阈值
- 📌 添加需要监控的服务

---

## 2. Dashboard 概览

登录后首先看到的是 **Dashboard（仪表盘）**，它是您的运维总览：

### 核心指标卡片

- **主机数量**：在线/离线主机数
- **服务状态**：健康/异常服务数
- **活跃告警**：当前未处理的告警数量
- **健康评分**：系统整体健康评分（0-100）

### 趋势图表

- CPU、内存、磁盘使用率趋势
- 告警数量趋势

### 实时更新

Dashboard 通过 WebSocket 实时推送数据，无需手动刷新。

---

## 3. 主机和服务监控

### 3.1 主机列表

进入 **主机管理** 页面可以看到所有被监控主机：

- **状态**：🟢 在线 / 🔴 离线
- **实时指标**：CPU、内存、磁盘使用率、网络流量、系统负载
- 点击主机名进入**详情页**，查看历史指标趋势图（支持 5 分钟/1 小时/1 天聚合）

### 3.2 服务监控

进入 **服务监控** 页面：

- 查看所有被发现的服务及其健康状态
- **可用率 (Uptime)**：服务的运行时间占比
- 点击服务名查看详情，包括依赖关系和历史状态

### 3.3 服务拓扑图

进入 **拓扑图** 页面：

- 可视化展示所有服务之间的依赖关系
- 支持拖拽调整布局
- 点击节点高亮关联服务
- 可保存自定义布局

---

## 4. 告警规则配置

### 4.1 查看告警

进入 **告警中心** 查看所有告警：

- **严重级别**：critical（紧急）/ warning（警告）/ info（信息）
- **状态**：firing（触发中）/ acknowledged（已确认）/ resolved（已恢复）
- 点击告警可查看详情，包括触发时间、关联主机、指标快照

### 4.2 配置告警规则

进入 **告警规则** 页面，可以新建或修改规则：

**支持的告警类型：**

| 类型 | 说明 | 示例 |
|------|------|------|
| 指标告警 | 基于主机指标阈值 | CPU > 90% 持续 5 分钟 |
| 日志关键词 | 检测日志中的关键词 | 日志出现 "OOM" 或 "Error" |
| 数据库告警 | 基于数据库指标 | 连接数 > 100（专业版） |

**配置步骤：**

1. 点击「新建规则」
2. 选择告警类型和关联资源
3. 设置阈值和运算符（>、<、=、>=、<=）
4. 设置持续时间（避免瞬时抖动误报）
5. 选择严重级别
6. 保存

### 4.3 确认和处理告警

- 收到告警后，点击「确认」标记为已知晓
- 问题解决后，告警会自动恢复为 resolved 状态
- 可使用 **AI 根因分析** 一键分析告警原因（见第 6 节）

---

## 5. 通知渠道配置

进入 **通知渠道** 页面配置告警通知方式。

### 5.1 钉钉

1. 在钉钉群中添加「自定义机器人」
2. 获取 Webhook URL 和签名密钥
3. 在 VigilOps 中新建钉钉渠道，填入 Webhook URL 和密钥
4. 发送测试消息验证

### 5.2 飞书

1. 在飞书群中添加「自定义机器人」
2. 获取 Webhook URL 和签名密钥
3. 在 VigilOps 中新建飞书渠道，填入相关信息
4. 飞书通知支持卡片消息格式，展示更美观

### 5.3 企业微信

1. 在企业微信群中添加「群机器人」
2. 获取 Webhook URL
3. 在 VigilOps 中新建企微渠道，填入 Webhook URL
4. 企微通知使用 Markdown 格式

### 5.4 邮件 (SMTP)

1. 准备 SMTP 服务器信息（地址、端口、用户名、密码）
2. 支持 SSL/TLS 加密
3. 在 VigilOps 中新建邮件渠道，填入 SMTP 配置和收件人列表

### 5.5 Webhook

1. 提供您的 Webhook 接收地址
2. VigilOps 将以 JSON 格式 POST 告警数据
3. 适用于与您自己的系统集成

### 5.6 通知模板

- 进入 **通知模板** 页面可自定义通知内容格式
- 支持变量：主机名、告警级别、指标值、触发时间等
- 系统已内置中文默认模板

> **提示**：系统内置告警降噪机制，同一告警在冷却期内不会重复通知，避免告警风暴。

---

## 6. AI 分析功能

VigilOps 集成了 AI 智能分析能力，让运维更轻松。

### 6.1 AI 对话

进入 **AI 分析** 页面：

- 像聊天一样向 AI 提问，例如：
  - "服务器现在状态怎么样？"
  - "最近有什么异常？"
  - "帮我分析一下 nginx 的日志"
- AI 会结合实时的主机指标、日志、告警、服务状态来回答

### 6.2 告警根因分析

在 **告警中心**，对任意告警点击「AI 根因分析」：

- AI 会自动关联告警前后 30 分钟的指标和日志
- 分析可能的根本原因
- 给出处理建议

### 6.3 AI 洞察

- AI 定期（每 30 分钟）自动扫描系统日志
- 发现异常模式会生成 **AI 洞察**
- 在 AI 分析页面可查看所有洞察，按严重级别筛选

### 6.4 系统概览

AI 分析页面顶部展示 **AI 系统概览**：

- 主机/服务/告警统计摘要
- 平均资源使用率
- AI 生成的运维建议

---

## 7. 数据库监控（专业版）

> 此功能仅限托管专业版客户

进入 **数据库监控** 页面：

### 监控指标

- **连接数**：当前/活跃连接数
- **数据库大小**：存储空间使用
- **QPS**：每秒查询数
- **慢查询 Top 10**：最慢的 SQL 语句
- **表数量**：数据库表总数
- **事务数**：事务处理统计

### 支持的数据库

- PostgreSQL
- MySQL
- Oracle

点击数据库名进入详情页，查看历史指标趋势图。

---

## 8. 自动修复（专业版）

> 此功能仅限托管专业版客户

进入 **自动修复** 页面管理修复任务。

### 8.1 内置修复方案（Runbook）

| Runbook | 触发场景 |
|---------|----------|
| 磁盘清理 | 磁盘使用率过高 |
| 服务重启 | 服务异常/不可用 |
| 僵尸进程清理 | 检测到僵尸进程 |
| 内存释放 | 内存使用率过高 |
| 日志轮转 | 日志文件过大 |
| 连接重置 | 数据库连接数过多 |

### 8.2 修复流程

1. 告警触发 → AI 自动诊断问题原因
2. 匹配合适的 Runbook
3. **需要审批**的操作进入审批流（您会收到通知）
4. 审批通过后自动执行修复命令
5. 执行后自动验证修复结果
6. 成功/失败均会通知到您配置的渠道

### 8.3 安全保障

- 所有修复命令在白名单内，禁止危险操作
- 敏感操作需人工审批后才执行
- 完整的修复日志可审计追溯

---

## 9. 运维报告

进入 **报告** 页面查看自动生成的运维报告：

- **日报**：每天凌晨 2:00 自动生成
- **周报**：每周一凌晨 3:00 自动生成
- 也可随时点击「生成报告」手动触发

报告内容包括：主机健康概况、告警统计、资源使用趋势、AI 分析总结等。

---

## 10. 常见问题

### Q: 主机显示离线怎么办？

**A:** 可能原因：
1. Agent 进程未运行 → 检查 `systemctl status vigilops-agent`
2. 网络不通 → 检查主机到平台的网络连通性
3. Token 过期 → 联系我们重新配置

### Q: 告警太多/太频繁怎么办？

**A:**
1. 调整告警阈值（如 CPU 从 80% 调到 90%）
2. 增加持续时间要求（如持续 5 分钟才触发，避免瞬时抖动）
3. 设置静默窗口（如维护时段不发告警）
4. 系统已内置冷却机制，同一告警不会短时间重复通知

### Q: AI 分析不可用？

**A:** AI 功能依赖外部 API 服务。如果出现不可用：
1. 检查网络是否能访问外部 API
2. 联系我们检查 API 配额是否用尽
3. AI 不可用不影响其他监控功能

### Q: 如何添加新的被监控主机？

**A:**
1. 联系我们获取 Agent Token
2. 在新主机上安装 Agent：`pip install vigilops-agent`
3. 配置 Agent 连接信息：`vigilops-agent --server-url http://平台地址:8001 --token <token>`
4. 启动 Agent，主机会自动注册并出现在 Dashboard 上

### Q: 数据保存多久？

**A:** 默认配置：
- 主机指标：原始数据 7 天，聚合数据更长
- 日志：30 天
- 告警记录：永久保留
- 可根据需要调整保留策略

### Q: 如何联系技术支持？

**A:**
- **基础版客户**：微信 / 邮件，工作日 8h 内响应
- **专业版客户**：专属运维群，7×24h 2h 内响应
- **紧急故障**：直接电话联系运维负责人

---

> **VigilOps** — 开源智能运维平台，让 AI 守护您的基础设施。
>
> 技术支持：[联系方式] | 官网：https://lchuang.net
