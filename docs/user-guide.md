# VigilOps 用户使用手册

> 版本：v1.0 | 更新日期：2026-02-21

---

## 目录

- [1. 概述](#1-概述)
- [2. 登录与用户管理](#2-登录与用户管理)
  - [2.1 登录](#21-登录)
  - [2.2 用户管理与 RBAC](#22-用户管理与-rbac)
- [3. 仪表盘（Dashboard）](#3-仪表盘dashboard)
- [4. 服务器管理（Hosts）](#4-服务器管理hosts)
  - [4.1 服务器列表](#41-服务器列表)
  - [4.2 服务器详情](#42-服务器详情)
- [5. 服务监控（Services）](#5-服务监控services)
  - [5.1 服务列表](#51-服务列表)
  - [5.2 服务详情](#52-服务详情)
- [6. 服务拓扑图（Topology）](#6-服务拓扑图topology)
- [7. 日志管理（Logs）](#7-日志管理logs)
- [8. 数据库监控（Databases）](#8-数据库监控databases)
  - [8.1 数据库列表](#81-数据库列表)
  - [8.2 数据库详情](#82-数据库详情)
- [9. 告警中心（Alerts）](#9-告警中心alerts)
  - [9.1 告警列表](#91-告警列表)
  - [9.2 告警规则配置](#92-告警规则配置)
- [10. AI 智能分析](#10-ai-智能分析)
- [11. 自动修复（Remediation）](#11-自动修复remediation)
  - [11.1 修复任务列表](#111-修复任务列表)
  - [11.2 内置 Runbook](#112-内置-runbook)
  - [11.3 安全机制](#113-安全机制)
- [12. 运维报告（Reports）](#12-运维报告reports)
- [13. SLA 管理](#13-sla-管理)
- [14. 通知管理](#14-通知管理)
  - [14.1 通知渠道配置](#141-通知渠道配置)
  - [14.2 通知模板](#142-通知模板)
  - [14.3 通知日志](#143-通知日志)
- [15. 审计日志（Audit Logs）](#15-审计日志audit-logs)
- [16. 系统设置（Settings）](#16-系统设置settings)

---

## 1. 概述

VigilOps 是一款开源运维监控平台，集成了 AI 智能分析与自动修复能力。核心功能包括：

- **实时监控**：服务器指标、服务状态、数据库性能的全方位监控
- **智能告警**：支持指标阈值、日志关键字、数据库阈值三种告警规则
- **AI 分析**：基于 DeepSeek API 的对话式根因分析与智能洞察
- **自动修复**：6 个内置 Runbook，支持安全审批流与 dry_run 模式
- **多渠道通知**：钉钉、飞书、企业微信、邮件、Webhook 五种渠道
- **SLA 管理**：可用性追踪、错误预算计算、违规自动检测

**技术架构**：FastAPI + React + PostgreSQL + Redis，通过 Docker Compose 一键部署。

---

## 2. 登录与用户管理

### 2.1 登录

1. 浏览器访问系统地址（默认 `http://<服务器IP>:3001`）
2. 输入用户名和密码
3. 点击「登录」，系统通过 JWT 进行身份认证
4. 登录成功后自动跳转到仪表盘页面

### 2.2 用户管理与 RBAC

**路径**：侧边栏 → 用户管理

系统采用基于角色的访问控制（RBAC），管理员可进行以下操作：

| 操作 | 说明 |
|------|------|
| 创建用户 | 点击「新建用户」，填写用户名、邮箱、密码，分配角色 |
| 编辑用户 | 点击用户行的编辑按钮，修改信息或角色 |
| 禁用/启用 | 切换用户的启用状态 |
| 删除用户 | 删除非管理员账户 |

**角色权限说明**：
- **管理员（admin）**：全部功能权限，包括用户管理、系统设置
- **运维人员（operator）**：监控、告警、修复等日常运维操作
- **只读用户（viewer）**：仅查看仪表盘和监控数据

---

## 3. 仪表盘（Dashboard）

**路径**：侧边栏 → 仪表盘

仪表盘是进入系统后的首页，提供全局运维态势的实时概览。

**核心功能**：

- **实时数据推送**：通过 WebSocket 连接，指标数据实时更新，无需手动刷新
- **健康评分**：系统根据各项指标综合计算整体健康评分（0-100），直观展示环境健康状态
- **趋势图表**：CPU、内存、磁盘、网络等关键指标的时间序列趋势图
- **概览卡片**：服务器总数、在线数、告警数、服务状态等关键数字一目了然

**操作说明**：
1. 页面加载后自动建立 WebSocket 连接，数据持续刷新
2. 点击健康评分卡片可查看评分详情和各维度得分
3. 趋势图支持时间范围选择（最近 1 小时 / 6 小时 / 24 小时 / 7 天）
4. 点击概览卡片中的数字可快速跳转到对应的详情页面

---

## 4. 服务器管理（Hosts）

### 4.1 服务器列表

**路径**：侧边栏 → 服务器管理

展示所有纳管服务器的概要信息。

**操作步骤**：

1. **添加服务器**：点击「添加主机」按钮，填写主机名、IP 地址、操作系统等信息
2. **搜索过滤**：通过顶部搜索框按主机名或 IP 筛选
3. **查看状态**：列表中显示各服务器的在线状态、CPU/内存使用率、最后上报时间
4. **批量操作**：勾选多台服务器可批量编辑标签或删除

### 4.2 服务器详情

点击服务器名称进入详情页，包含：

- **基本信息**：主机名、IP、操作系统、内核版本、运行时长
- **实时指标**：CPU 使用率、内存使用率、磁盘使用率、网络流量
- **指标趋势**：各项指标的历史趋势图
- **关联服务**：该服务器上运行的服务列表
- **最近告警**：与该服务器相关的告警记录

---

## 5. 服务监控（Services）

### 5.1 服务列表

**路径**：侧边栏 → 服务监控

展示所有监控服务的状态。支持按分类筛选：

| 分类 | 说明 | 示例 |
|------|------|------|
| **middleware** | 中间件服务 | Nginx、Redis、RabbitMQ |
| **business** | 业务服务 | API 网关、用户服务、订单服务 |
| **infrastructure** | 基础设施 | DNS、NTP、存储服务 |

**操作步骤**：

1. **添加服务**：点击「新建服务」，填写服务名称、类型、检测方式、目标地址
2. **检测方式**：
   - **HTTP 检测**：配置 URL、期望状态码、超时时间
   - **TCP 检测**：配置主机和端口，检测端口连通性
3. **分类筛选**：使用顶部分类标签快速过滤
4. **状态查看**：绿色（正常）、黄色（警告）、红色（故障）

### 5.2 服务详情

点击服务名称进入详情页：

- **服务状态**：当前状态、响应时间、最后检测时间
- **可用性统计**：最近 24 小时 / 7 天 / 30 天的可用率
- **响应时间趋势**：响应时间随时间的变化曲线
- **关联依赖**：该服务所依赖的上下游服务
- **告警历史**：相关告警记录

---

## 6. 服务拓扑图（Topology）

**路径**：侧边栏 → 服务拓扑

以可视化图形展示服务之间的依赖关系。

**布局模式**：

| 模式 | 说明 |
|------|------|
| **力导向布局** | 基于物理模拟的自由布局，节点自动排列 |
| **分层布局** | 按依赖层级从上到下排列，层次清晰 |

**操作说明**：

1. **切换布局**：顶部工具栏切换力导向/分层布局模式
2. **拖拽节点**：鼠标拖拽任意节点调整位置，松开后位置自动保存
3. **缩放平移**：鼠标滚轮缩放，按住空白区域拖拽平移
4. **查看详情**：点击节点查看服务详情，点击连线查看依赖关系
5. **邻接高亮**：悬停节点时，高亮其直接关联的上下游节点和连线
6. **AI 建议依赖**：点击「AI 分析」按钮，系统基于流量和日志数据自动推荐可能的服务依赖关系，确认后可一键添加

---

## 7. 日志管理（Logs）

**路径**：侧边栏 → 日志管理

提供集中化的日志搜索与实时查看能力。

**功能说明**：

- **日志搜索**：
  1. 在搜索框输入关键字、正则表达式或结构化查询
  2. 选择时间范围（最近 15 分钟 / 1 小时 / 24 小时 / 自定义）
  3. 按主机、服务、日志级别（INFO / WARN / ERROR / FATAL）筛选
  4. 点击「搜索」查看结果，支持分页浏览

- **实时日志流**：
  1. 点击「实时流」按钮开启实时日志推送
  2. 新日志自动追加到列表底部
  3. 支持暂停/继续，暂停期间日志缓存不丢失
  4. 可设置关键字高亮规则

- **日志详情**：点击任意日志条目展开完整内容，包含时间戳、来源主机、服务名、日志级别和完整消息

---

## 8. 数据库监控（Databases）

### 8.1 数据库列表

**路径**：侧边栏 → 数据库监控

展示所有纳管数据库实例及其关键指标。

**支持的数据库类型**：
- PostgreSQL
- MySQL
- Oracle

**列表信息**：数据库名称、类型、状态、连接数、QPS、最后采集时间

### 8.2 数据库详情

点击数据库名称进入详情页：

- **连接信息**：主机、端口、数据库名
- **性能指标**：
  - 活跃连接数 / 最大连接数
  - QPS（每秒查询数）
  - TPS（每秒事务数）
  - 缓冲区命中率
- **慢查询 Top 10**：按执行时间排序的最慢查询列表，包含 SQL 语句、平均执行时间、调用次数
- **趋势图表**：连接数、QPS 等指标的时间趋势

**操作步骤**：
1. **添加数据库**：点击「添加数据库」，选择类型，填写连接信息
2. **查看慢查询**：切换到「慢查询」标签页，查看 Top 10 慢查询及优化建议
3. **设置告警**：可针对连接数、QPS 等指标设置阈值告警

---

## 9. 告警中心（Alerts）

### 9.1 告警列表

**路径**：侧边栏 → 告警中心

集中展示所有告警事件。

**列表功能**：
- 按状态筛选：活跃（firing）、已确认（acknowledged）、已解决（resolved）
- 按严重程度筛选：紧急（critical）、警告（warning）、信息（info）
- 按时间范围、主机、服务筛选
- **AI 根因分析**：点击告警条目中的「AI 分析」按钮，系统自动调用 DeepSeek API 进行根因分析，返回可能的原因和建议操作

**告警操作**：
1. **确认告警**：点击「确认」按钮标记为已知，不再重复通知
2. **解决告警**：告警恢复后点击「解决」关闭
3. **查看详情**：展开告警查看完整上下文、关联指标、历史发生次数
4. **触发修复**：从告警直接跳转到自动修复，使用对应 Runbook 处理

### 9.2 告警规则配置

系统支持三种告警规则类型：

#### 1. 指标告警

针对服务器或服务的性能指标设置阈值。

| 配置项 | 说明 |
|--------|------|
| 指标名称 | CPU 使用率、内存使用率、磁盘使用率等 |
| 比较方式 | 大于、小于、等于 |
| 阈值 | 触发告警的数值（如 CPU > 90%） |
| 持续时间 | 指标持续超过阈值的时间（如连续 5 分钟） |
| 严重程度 | critical / warning / info |

**操作步骤**：
1. 进入告警规则页面，点击「新建规则」
2. 选择规则类型为「指标告警」
3. 选择目标主机或服务
4. 配置指标名称、阈值条件和持续时间
5. 设置严重程度和通知渠道
6. 保存并启用

#### 2. 日志关键字告警

当日志中出现指定关键字时触发告警。

| 配置项 | 说明 |
|--------|------|
| 关键字 | 匹配的字符串或正则表达式 |
| 日志来源 | 指定主机或服务 |
| 日志级别 | 匹配的日志级别（可选） |
| 时间窗口内次数 | 指定时间窗口内出现次数达到阈值触发 |

#### 3. 数据库阈值告警

针对数据库的性能指标设置阈值。

| 配置项 | 说明 |
|--------|------|
| 数据库实例 | 选择监控的数据库 |
| 指标 | 连接数、QPS、慢查询数量、缓冲区命中率等 |
| 阈值条件 | 大于/小于指定值 |
| 持续时间 | 持续超过阈值的时间 |

---

## 10. AI 智能分析

**路径**：侧边栏 → AI 分析

基于 DeepSeek API 的 AI 运维助手，提供智能化的运维支持。

**功能模块**：

#### 概览卡片
页面顶部展示 AI 分析的统计概览：
- 待处理洞察数量
- 近期根因分析次数
- AI 建议采纳率

#### 对话界面
与 AI 助手进行对话式交互：
1. 在输入框中输入运维相关问题（如「最近 CPU 飙高的原因是什么？」）
2. AI 结合当前监控数据和历史告警进行分析
3. 返回结构化的分析结果和建议操作
4. 支持多轮对话，可追问细节

**常见问题示例**：
- 「分析最近 1 小时的告警趋势」
- 「服务 X 响应变慢的可能原因」
- 「数据库连接数持续增长怎么排查」
- 「当前系统最大的风险点是什么」

#### 智能洞察列表
AI 自动生成的运维洞察，包括：
- 异常模式检测结果
- 容量规划建议
- 性能优化建议
- 潜在风险预警

每条洞察包含严重程度、描述、建议操作和相关资源链接。

---

## 11. 自动修复（Remediation）

### 11.1 修复任务列表

**路径**：侧边栏 → 自动修复

展示所有修复任务的执行记录：
- 任务状态：待审批、执行中、已完成、已失败
- 触发来源：手动触发 / 告警自动触发
- 关联告警和目标主机
- 执行日志和结果

### 11.2 内置 Runbook

系统提供 6 个开箱即用的修复 Runbook：

| Runbook | 功能 | 适用场景 |
|---------|------|----------|
| **disk_cleanup** | 磁盘清理 | 磁盘使用率过高，清理临时文件、旧日志、缓存 |
| **memory_pressure** | 内存压力缓解 | 内存使用率过高，释放缓存、重启内存泄漏进程 |
| **service_restart** | 服务重启 | 服务无响应或异常，自动重启指定服务 |
| **log_rotation** | 日志轮转 | 日志文件过大，执行日志切割和压缩归档 |
| **zombie_killer** | 僵尸进程清理 | 系统存在大量僵尸进程，自动清理 |
| **connection_reset** | 连接重置 | 连接数异常，重置数据库或服务的连接池 |

### 11.3 安全机制

自动修复系统内置多重安全保障：

- **安全检查**：执行前自动检查目标主机状态，评估操作风险
- **审批流**：高风险操作需人工审批后才能执行
  1. 修复任务创建后进入「待审批」状态
  2. 管理员在任务详情页查看修复计划
  3. 确认无误后点击「批准执行」
  4. 也可拒绝并添加拒绝原因
- **dry_run 模式**：在创建修复任务时勾选「试运行」，系统模拟执行流程但不实际操作，用于验证 Runbook 逻辑

**手动触发修复**：
1. 进入自动修复页面，点击「新建修复任务」
2. 选择目标主机
3. 选择 Runbook
4. 配置参数（可选）
5. 选择是否开启 dry_run
6. 提交后等待审批（如需）并执行

---

## 12. 运维报告（Reports）

**路径**：侧边栏 → 运维报告

自动生成运维报告，支持定期和手动两种方式。

**报告内容包括**：
- 监控概览：服务器/服务的整体健康状态
- 告警统计：告警数量、分布、处理时效
- 可用性报告：各服务的可用率统计
- 性能趋势：关键指标趋势分析
- AI 分析摘要：期间的 AI 洞察和建议

**操作步骤**：
1. 点击「生成报告」
2. 选择时间范围（日报 / 周报 / 月报 / 自定义）
3. 选择报告内容模块
4. 点击「生成」，系统自动汇总数据生成报告
5. 生成后可在线查看或导出

---

## 13. SLA 管理

**路径**：侧边栏 → SLA 管理

管理服务等级协议，追踪服务可用性承诺。

**核心功能**：

#### 可用性追踪
- 为每个服务或服务组定义 SLA 目标（如 99.9%）
- 系统自动计算实际可用性
- 以图表展示可用性趋势

#### 错误预算
- 基于 SLA 目标自动计算错误预算（如 99.9% SLA 允许每月约 43 分钟停机）
- 实时显示已消耗和剩余的错误预算
- 预算消耗速度预警

#### 违规检测
- 当可用性低于 SLA 目标时自动检测并记录违规
- 违规事件包含开始时间、持续时长、影响范围
- 可配置违规时的通知策略

**操作步骤**：
1. 点击「新建 SLA」
2. 选择关联的服务
3. 设置可用性目标百分比（如 99.9%）
4. 配置计算周期（月度/季度/年度）
5. 设置违规通知规则
6. 保存后系统自动开始追踪

---

## 14. 通知管理

### 14.1 通知渠道配置

**路径**：侧边栏 → 通知管理 → 通知渠道

系统支持 5 种通知渠道，配置说明如下：

#### 钉钉

1. 在钉钉群中添加自定义机器人，获取 Webhook URL
2. 设置安全策略时选择「自定义关键词」
3. 在 VigilOps 中新建钉钉渠道：
   - 填写渠道名称
   - 粘贴 Webhook URL
   - 填写关键词（必须与钉钉机器人安全设置中的关键词一致）

#### 飞书

1. 在飞书群中添加自定义机器人，获取 Webhook URL
2. 在 VigilOps 中新建飞书渠道：
   - 填写渠道名称
   - 粘贴 Webhook URL

#### 企业微信

1. 在企业微信群中添加群机器人，获取 Webhook URL
2. 在 VigilOps 中新建企微渠道：
   - 填写渠道名称
   - 粘贴 Webhook URL

#### 邮件

配置 SMTP 服务器信息：

| 配置项 | 说明 |
|--------|------|
| SMTP 服务器 | 邮件服务器地址（如 smtp.163.com） |
| 端口 | SMTP 端口（25 / 465 / 587） |
| 加密方式 | None / SSL / TLS |
| 发件人邮箱 | 发送告警邮件的邮箱地址 |
| 认证密码 | 邮箱密码或授权码 |
| 收件人列表 | 接收告警的邮箱，多个用逗号分隔 |

#### Webhook

用于对接自定义系统：
1. 新建 Webhook 渠道
2. 填写目标 URL
3. 告警触发时，系统以 JSON 格式 POST 告警数据到该 URL

### 14.2 通知模板

**路径**：侧边栏 → 通知管理 → 通知模板

自定义通知消息的格式和内容：
1. 点击「新建模板」
2. 填写模板名称
3. 编辑模板内容，支持变量替换（如 `{{alert_name}}`、`{{host_name}}`、`{{severity}}`）
4. 选择适用的渠道类型
5. 保存后在告警规则中关联使用

### 14.3 通知日志

**路径**：侧边栏 → 通知管理 → 通知日志

查看所有通知的发送记录：
- 发送时间、目标渠道、通知内容
- 发送状态：成功 / 失败
- 失败原因（如 Webhook 超时、SMTP 连接失败等）

---

## 15. 审计日志（Audit Logs）

**路径**：侧边栏 → 审计日志

记录系统中所有重要操作，用于安全审计和操作追溯。

**记录内容**：
- 操作人、操作时间
- 操作类型（创建、修改、删除、登录等）
- 操作对象（主机、服务、告警规则、用户等）
- 操作详情和变更内容

**筛选方式**：
- 按操作人筛选
- 按操作类型筛选
- 按时间范围筛选

---

## 16. 系统设置（Settings）

**路径**：侧边栏 → 系统设置

全局系统配置，包括：

- **基础设置**：系统名称、时区、数据保留策略
- **AI 配置**：DeepSeek API Key、模型选择、调用参数
- **告警设置**：全局告警冷却期、静默期配置
- **Agent 配置**：Agent Token 管理，用于 Agent 数据上报认证
  - 创建 Token：生成新的 Agent 认证 Token
  - 查看 Token 列表：管理已有 Token
  - 吊销 Token：禁用不再使用的 Token
- **通知降噪**：配置通知冷却期（同一告警在冷却期内不重复发送）和静默期（指定时间段内不发送通知）

---

> **反馈与支持**：如有问题或建议，请通过 GitHub Issues 提交：[github.com/LinChuang2008/vigilops](https://github.com/LinChuang2008/vigilops)
